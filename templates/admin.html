<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin – Moov Authume</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>Espace Administrateur – Moov Authume</h1>

    <h2>👤 Ajouter un adhérent</h2>
    <input id="name" placeholder="Nom complet">
    <input id="email" placeholder="Email">
    <label>Date de validité :</label>
    <input id="expiration" type="date">
    <button onclick="addMember()">Ajouter</button>

    <div id="qr-result"></div>

    <h2>📋 Liste des adhérents</h2>
    <table>
      <tr><th>Nom</th><th>Email</th><th>Expiration</th><th>Actions</th></tr>
      {% for m in members %}
        <tr>
          <td>{{ m.name }}</td>
          <td>{{ m.email }}</td>
          <td>{{ m.expiration }}</td>
          <td>
            <button onclick="deleteMember('{{m.name}}')">🗑 Supprimer</button>
          </td>
        </tr>
      {% endfor %}
    </table>

    <h2>🎪 Gestion des événements</h2>
    <input id="eventName" placeholder="Nom de l’événement">
    <button onclick="addEvent()">Ajouter</button>
    <ul id="event-list">
      {% for e in events %}
        <li>{{ e }} <button onclick="deleteEvent('{{e}}')">🗑</button></li>
      {% endfor %}
    </ul>

    <h2>🙋‍♂️ Gestion des bénévoles</h2>
    <input id="volName" placeholder="Nom du bénévole">
    <button onclick="addVolunteer()">Ajouter</button>
    <ul id="vol-list">
      {% for v in volunteers %}
        <li>{{ v }} <button onclick="deleteVolunteer('{{v}}')">🗑</button></li>
      {% endfor %}
    </ul>

    <p><a href="/" class="btn">⬅ Retour à l’accueil</a></p>
  </div>

<script>
function addMember() {
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const expiration = document.getElementById("expiration").value;

  fetch("/add_member", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name, email, expiration})
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === "ok") {
      document.getElementById("qr-result").innerHTML = `
        <h3>QR Code généré :</h3>
        <img src="data:image/png;base64,${data.qr}" style="width:200px">
      `;
      setTimeout(() => location.reload(), 1500);
    }
  });
}

function deleteMember(name) {
  fetch("/delete_member", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function addEvent() {
  const name = document.getElementById("eventName").value;
  fetch("/add_event", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function deleteEvent(name) {
  fetch("/delete_event", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function addVolunteer() {
  const name = document.getElementById("volName").value;
  fetch("/add_volunteer", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function deleteVolunteer(name) {
  fetch("/delete_volunteer", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}
</script>
</body>
</html>

