<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin ‚Äì Moov Authume</title>
  <link rel="stylesheet" href="/static/style.css">
  <script>
    async function checkPassword() {
      const pass = prompt("Mot de passe admin :");
      const res = await fetch("/get-admin-password");
      const data = await res.json();
      if (pass !== data.password) {
        alert("Mot de passe incorrect !");
        window.location.href = "/";
      }
    }

    document.addEventListener("DOMContentLoaded", checkPassword);

    async function addMember() {
      const name = document.getElementById("member_name").value;
      const email = document.getElementById("member_email").value;
      const res = await fetch("/add_member", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({name, email})
      });
      const data = await res.json();
      if (data.status === "ok") {
        alert("Adh√©rent ajout√© !");
        location.reload();
      }
    }

    async function deleteMember(name) {
      if (confirm(`Supprimer ${name} ?`)) {
        await fetch("/delete_member", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({name})
        });
        location.reload();
      }
    }

    async function extendMember(name) {
      await fetch("/extend_member", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({name})
      });
      alert("Date de validit√© prolong√©e d‚Äôun an !");
      location.reload();
    }

    async function addVolunteer() {
      const name = document.getElementById("volunteer_name").value;
      await fetch("/add_volunteer", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({name})
      });
      alert("B√©n√©vole ajout√© !");
      location.reload();
    }

    async function deleteVolunteer(name) {
      if (confirm(`Supprimer ${name} ?`)) {
        await fetch("/delete_volunteer", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({name})
        });
        location.reload();
      }
    }

    async function addEvent() {
      const name = document.getElementById("event_name").value;
      await fetch("/add_event", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({name})
      });
      alert("√âv√©nement ajout√© !");
      location.reload();
    }

    async function deleteEvent(name) {
      if (confirm(`Supprimer ${name} ?`)) {
        await fetch("/delete_event", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({name})
        });
        location.reload();
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <h1>üõ†Ô∏è Panneau d‚Äôadministration ‚Äì Moov Authume</h1>

    <!-- Gestion des adh√©rents -->
    <section>
      <h2>üë§ Adh√©rents</h2>
      <input id="member_name" placeholder="Nom complet">
      <input id="member_email" placeholder="Email">
      <button onclick="addMember()">Ajouter</button>
      <a href="/export_members" class="btn">üì• Export CSV</a>

      <table>
        <tr><th>Nom</th><th>Email</th><th>Expiration</th><th>Actions</th></tr>
        {% for m in members %}
        <tr>
          <td>{{ m.name }}</td>
          <td>{{ m.email }}</td>
          <td>{{ m.expiration }}</td>
          <td>
            <button onclick="extendMember('{{ m.name }}')">Prolonger</button>
            <button onclick="deleteMember('{{ m.name }}')">Supprimer</button>
          </td>
        </tr>
        {% endfor %}
      </table>
    </section>

    <!-- Gestion des b√©n√©voles -->
    <section>
      <h2>ü§ù B√©n√©voles</h2>
      <input id="volunteer_name" placeholder="Nom du b√©n√©vole">
      <button onclick="addVolunteer()">Ajouter</button>
      <ul>
        {% for v in volunteers %}
          <li>{{ v }} <button onclick="deleteVolunteer('{{ v }}')">Supprimer</button></li>
        {% endfor %}
      </ul>
    </section>

    <!-- Gestion des √©v√©nements -->
    <section>
      <h2>üéâ √âv√©nements</h2>
      <input id="event_name" placeholder="Nom de l‚Äô√©v√©nement">
      <button onclick="addEvent()">Ajouter</button>
      <ul>
        {% for e in events %}
          <li>{{ e }} <button onclick="deleteEvent('{{ e }}')">Supprimer</button></li>
        {% endfor %}
      </ul>
    </section>

    <p><a href="/" class="btn">‚¨Ö Retour √† l‚Äôaccueil</a></p>
  </div>
</body>
</html>
