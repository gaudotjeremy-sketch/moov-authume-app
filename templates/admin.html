<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin â€“ Moov Authume</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>Espace Administrateur â€“ Moov Authume</h1>

    <h2>ğŸ‘¤ Ajouter un adhÃ©rent</h2>
    <input id="name" placeholder="Nom complet">
    <input id="email" placeholder="Email">
    <label>Date de validitÃ© :</label>
    <input id="expiration" type="date">
    <button onclick="addMember()">Ajouter</button>

    <div id="qr-result"></div>

    <h2>ğŸ“‹ Liste des adhÃ©rents</h2>
    <table>
      <tr><th>Nom</th><th>Email</th><th>Expiration</th><th>Actions</th></tr>
      {% for m in members %}
        <tr>
          <td>{{ m.name }}</td>
          <td>{{ m.email }}</td>
          <td>{{ m.expiration }}</td>
          <td>
            <button onclick="deleteMember('{{m.name}}')">ğŸ—‘ Supprimer</button>
          </td>
        </tr>
      {% endfor %}
    </table>

    <h2>ğŸª Gestion des Ã©vÃ©nements</h2>
    <input id="eventName" placeholder="Nom de lâ€™Ã©vÃ©nement">
    <button onclick="addEvent()">Ajouter</button>
    <ul id="event-list">
      {% for e in events %}
        <li>{{ e }} <button onclick="deleteEvent('{{e}}')">ğŸ—‘</button></li>
      {% endfor %}
    </ul>

    <h2>ğŸ™‹â€â™‚ï¸ Gestion des bÃ©nÃ©voles</h2>
    <input id="volName" placeholder="Nom du bÃ©nÃ©vole">
    <button onclick="addVolunteer()">Ajouter</button>
    <ul id="vol-list">
      {% for v in volunteers %}
        <li>{{ v }} <button onclick="deleteVolunteer('{{v}}')">ğŸ—‘</button></li>
      {% endfor %}
    </ul>

    <p><a href="/" class="btn">â¬… Retour Ã  lâ€™accueil</a></p>
  </div>

<script>
function addMember() {
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const expiration = document.getElementById("expiration").value;

  fetch("/add_member", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name, email, expiration})
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === "ok") {
      document.getElementById("qr-result").innerHTML = `
        <h3>QR Code gÃ©nÃ©rÃ© :</h3>
        <img src="data:image/png;base64,${data.qr}" style="width:200px">
      `;
      setTimeout(() => location.reload(), 1500);
    }
  });
}

function deleteMember(name) {
  fetch("/delete_member", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function addEvent() {
  const name = document.getElementById("eventName").value;
  fetch("/add_event", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function deleteEvent(name) {
  fetch("/delete_event", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function addVolunteer() {
  const name = document.getElementById("volName").value;
  fetch("/add_volunteer", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}

function deleteVolunteer(name) {
  fetch("/delete_volunteer", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({name})
  }).then(() => location.reload());
}
</script>
</body>
</html>

