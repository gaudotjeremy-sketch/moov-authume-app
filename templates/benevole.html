<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Espace BÃ©nÃ©vole ğŸ‘·</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <header>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
        Espace BÃ©nÃ©vole ğŸ‘·
    </header>

    <div style="margin-top:10px;">
        <a href="/"><button>ğŸ  Accueil</button></a>
        <a href="/benevole"><button style="background:#0288d1;">ğŸ¯ Scanner</button></a>
        <a href="/admin"><button>âš™ï¸ Espace Admin</button></a>
    </div>

    <h2>Scanner un QR Code ğŸ¯</h2>
    <select id="event">
        {% for e in events %}
            <option value="{{ e[0] }}">{{ e[1] }} ({{ e[2] }})</option>
        {% endfor %}
    </select>

    <select id="volunteer">
        {% for v in volunteers %}
            <option value="{{ v[1] }}">{{ v[1] }}</option>
        {% endfor %}
    </select>

    <select id="bon_type">
        <option value="boisson">ğŸ¥¤ Boisson</option>
        <option value="repas">ğŸ” Repas</option>
        <option value="autre">ğŸ Autre</option>
    </select>

    <div id="reader" style="width:300px; margin:auto; margin-top:20px;"></div>
    <p id="result"></p>

    <script>
        const resultDiv = document.getElementById("result");
        const html5QrCode = new Html5Qrcode("reader");

        html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
            qrCodeMessage => {
                fetch("/scan", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        qr: qrCodeMessage,
                        event_id: document.getElementById("event").value,
                        volunteer: document.getElementById("volunteer").value,
                        bon_type: document.getElementById("bon_type").value
                    })
                })
                .then(r => r.json())
                .then(data => {
                    resultDiv.innerText = data.message;
                    resultDiv.style.color = data.status === "ok" ? "green" : "red";
                });
            },
            err => {}
        );
    </script>
</body>
</html>
